[
    {
        "name": "base.qcow2",
        "packages": [
            "bpftool",
            "ca-certificates",
            "curl",
            "iproute2",
            "less",
            "openssh-server",
            "sudo",
            "util-linux",
            "vim",
	    "binutils"
        ],
        "actions": [
            {
                "comment": "disable password for root",
                "op": {
                    "Cmd": "passwd -d root"
                },
                "type": "run-command"
            },
            {
                "comment": "disable systemd timers",
                "op": {
                    "Cmd": "rm /lib/systemd/system/*.timer"
                },
                "type": "run-command"
            },
            {
                "op": {
                    "File": "/etc/systemd/system.conf",
                    "Line": "DefaultLimitNOFILE=65535"
                },
                "type": "append-line"
            },
            {
                "op": {
                    "File": "/etc/sysctl.conf",
                    "Line": "fs.inotify.max_user_watches = 524288"
                },
                "type": "append-line"
            },
            {
                "op": {
                    "File": "/etc/sysctl.conf",
                    "Line": "fs.inotify.max_user_instances = 512"
                },
                "type": "append-line"
            }
        ]
    },
    {
        "name": "kind.qcow2",
        "image_size": "20G",
        "packages": [
            "bpftool",
            "ca-certificates",
            "curl",
            "iproute2",
            "less",
            "openssh-server",
            "sudo",
            "util-linux",
            "vim",
            "build-essential",
            "git",
            "golang-1.19-go",
            "gpg",
            "libarchive-tools"
        ],
        "actions": [
            {
                "comment": "disable password for root",
                "op": {
                    "Cmd": "passwd -d root"
                },
                "type": "run-command"
            },
            {
                "comment": "disable systemd timers",
                "op": {
                    "Cmd": "rm /lib/systemd/system/*.timer"
                },
                "type": "run-command"
            },
            {
                "op": {
                    "File": "/etc/systemd/system.conf",
                    "Line": "DefaultLimitNOFILE=65535"
                },
                "type": "append-line"
            },
            {
                "op": {
                    "File": "/etc/sysctl.conf",
                    "Line": "fs.inotify.max_user_watches = 524288"
                },
                "type": "append-line"
            },
            {
                "op": {
                    "File": "/etc/sysctl.conf",
                    "Line": "fs.inotify.max_user_instances = 512"
                },
                "type": "append-line"
            },
            {
                "comment": "env",
                "op": {
                    "File": "env.sh",
                    "Dest": "/etc/profile.d/path.sh"
                },
                "type": "upload"
            },
            {
                "comment": "copy-in bootstrap dir",
                "op": {
                    "LocalPath": "bootstrap",
                    "RemoteDir": "/"
                },
                "type": "copy-in"
            },
            {
                "comment": "enable networking",
                "op": {
                    "Cmd": "/bootstrap/networkd.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "configure sshd",
                "op": {
                    "Cmd": "/bootstrap/sshd.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "configure mounts",
                "op": {
                    "Cmd": "/bootstrap/fstab.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "install docker",
                "op": {
                    "Cmd": "/bootstrap/deb-docker.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "install kind",
                "op": {
                    "Cmd": "/bootstrap/kind.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "install kubectl",
                "op": {
                    "Cmd": "/bootstrap/deb-k8s.sh"
                },
                "type": "run-command"
            }
        ]
    },
    {
        "name": "kind_4.19.qcow2",
	"parent": "kind.qcow2",
        "actions": [
            {
                "comment": "install 4.19",
                "op": {
                    "KernelInstallDir": "kernels/4.19/tar-install"
                },
                "type": "install-kernel"
            },
            { "op": { "Hostname": "kind-4.19"}, "type": "set-hostname" }
        ]
    },
    {
        "name": "kind_5.4.qcow2",
	"parent": "kind.qcow2",
        "actions": [
            {
                "comment": "install 5.4",
                "op": {
                    "KernelInstallDir": "kernels/5.4/tar-install"
                },
                "type": "install-kernel"
            },
            { "op": { "Hostname": "kind-5.4"}, "type": "set-hostname" }
        ]
    },
    {
        "name": "kind_5.10.qcow2",
	"parent": "kind.qcow2",
        "actions": [
            {
                "comment": "install 5.10",
                "op": {
                    "KernelInstallDir": "kernels/5.10/tar-install"
                },
                "type": "install-kernel"
            },
            { "op": { "Hostname": "kind-5.10"}, "type": "set-hostname" }
        ]
    },
    {
        "name": "kind_bpf-next.qcow2",
	"parent": "kind.qcow2",
        "actions": [
            {
                "comment": "install bpf-next",
                "op": {
                    "KernelInstallDir": "kernels/bpf-next/tar-install"
                },
                "type": "install-kernel"
            },
            { "op": { "Hostname": "kind-bpf-next"}, "type": "set-hostname" }
        ]
    }
]
