name: update images
on:
  # Allow manual triggers.
  workflow_dispatch: {}
  # Run weekly (every Monday at 00:01)
  schedule:
    - cron: "0 1 * * 1"
jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: commit
        id: commit
        run: |
          id=$(date +%Y%m%d.%H%M%S)
          git switch -c pr/update-images-${id}
          git config user.name "GH action"
          git config user.email "ghabot@does.not.exist.cilium.org"
          echo "update $id" > misc/dummy
          git add misc/dummy
          git commit -a -m "update-images: $id"
          git show HEAD
          git push --set-upstream origin pr/update-images-${id}
          echo "id=$id" | tee -a $GITHUB_OUTPUT
      - name: push PR
        env:
          GH_TOKEN: ${{ secrets.LVH_GITHUB_TOKEN }}
        run: |
          id=${{ steps.commit.outputs.id }}
          gh pr create \
            --title "update images: $id" \
            --body "PR to update images" \
